<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ú–æ–Ω–æ–ø–æ–ª–∏—è –¥–ª—è LG Smart TV</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }
    
    .app {
      display: flex;
      width: 100%;
      height: 100%;
      padding: 20px;
      gap: 20px;
    }
    
    .board-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #0b1225, #0a0f1f);
      border-radius: 16px;
      position: relative;
    }
    
    .board {
      width: 90%;
      height: 90%;
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      grid-template-rows: repeat(11, 1fr);
      gap: 4px;
      padding: 8px;
      background: #0a0f1f;
    }
    
    .cell {
      background: #111827;
      border: 2px solid #1f2937;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 6px;
      font-size: 14px;
      position: relative;
      font-weight: 600;
    }
    
    .cell.active {
      border-color: #f59e0b;
      background: #1e293b;
    }
    
    .cell .price {
      position: absolute;
      bottom: 4px;
      right: 6px;
      font-size: 12px;
      color: #94a3b8;
    }
    
    .center {
      grid-area: 3 / 3 / span 7 / span 7;
      border-radius: 16px;
      background: radial-gradient(ellipse at center, #0c1328 0%, #0a0f1f 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .dice-wrap {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .die {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      background: white;
      border: 2px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 48px;
      color: #1e293b;
    }
    
    .turn-hud {
      padding: 10px 20px;
      background: rgba(17, 24, 39, 0.9);
      border: 2px solid #f59e0b;
      border-radius: 10px;
      font-weight: 700;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .player-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid white;
    }
    
    .pips {
      position: absolute;
      bottom: 6px;
      left: 6px;
      display: flex;
      gap: 4px;
      z-index: 10;
    }
    
    .pip {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid white;
    }
    
    .owner-tag {
      position: absolute;
      left: 0;
      bottom: 0;
      height: 6px;
      width: 100%;
      border-bottom-left-radius: 6px;
      border-bottom-right-radius: 6px;
    }
    
    .sidebar {
      width: 400px;
      background: #111827;
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow-y: auto;
    }
    
    .sidebar h2 {
      color: #f59e0b;
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    button {
      background: #1f2937;
      color: #e5e7eb;
      border: 2px solid #334155;
      padding: 15px 20px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
    }
    
    button:hover {
      background: #2d3748;
      border-color: #475569;
    }
    
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    button.primary {
      background: #16a34a;
      border-color: #16a34a;
    }
    
    button.danger {
      background: #dc2626;
      border-color: #dc2626;
    }
    
    button.warning {
      background: #f59e0b;
      border-color: #f59e0b;
    }
    
    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .players-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .player-card {
      background: #0f172a;
      border: 2px solid #334155;
      border-radius: 8px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .player-card.active {
      border-color: #f59e0b;
      background: #1e293b;
    }
    
    .player-card.in-jail {
      border-color: #ef4444;
      background: #2d1414;
    }
    
    .player-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .swatch {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 2px solid white;
    }
    
    .player-money {
      font-size: 20px;
      font-weight: 900;
      color: #22c55e;
    }
    
    .jail-badge {
      background: #ef4444;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 700;
      margin-left: 8px;
    }
    
    .log {
      background: #0f172a;
      border: 2px solid #334155;
      border-radius: 8px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 14px;
    }
    
    .log-entry {
      padding: 6px;
      margin-bottom: 4px;
      border-left: 3px solid #334155;
      padding-left: 10px;
    }
    
    .log-entry.important {
      border-left-color: #f59e0b;
      background: rgba(245, 158, 11, 0.1);
    }
    
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: #1e293b;
      border: 2px solid #334155;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
    }
    
    .modal-content h2 {
      color: #f59e0b;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px;
      background: #0f172a;
      border: 2px solid #334155;
      border-radius: 6px;
      color: #e5e7eb;
      font-size: 16px;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: #1e293b;
      border: 2px solid #f59e0b;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 18px;
      z-index: 200;
      display: none;
    }
    
    .toast.show {
      display: block;
    }
    
    .anno {
      position: absolute;
      left: 50%;
      top: 30%;
      transform: translate(-50%, -50%);
      max-width: 70%;
      padding: 20px 30px;
      border-radius: 16px;
      background: rgba(17, 24, 39, 0.95);
      border: 2px solid #475569;
      font-size: 20px;
      line-height: 1.5;
      text-align: center;
      z-index: 15;
      display: none;
    }
    
    .anno.show {
      display: block;
    }
    
    .anno.buy {
      color: #22c55e;
    }
    
    .anno.rent {
      color: #ef4444;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="board-wrap">
      <div class="board" id="board">
        <div class="center">
          <div class="dice-wrap">
            <div class="die" id="die1">1</div>
            <div class="die" id="die2">1</div>
          </div>
          <div class="turn-hud">
            <div class="player-dot" id="turnDot"></div>
            <span id="turnName">–ò–≥—Ä–æ–∫ 1</span>
          </div>
        </div>
      </div>
      <div class="anno" id="anno"></div>
    </div>
    
    <aside class="sidebar">
      <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
      
      <div class="controls">
        <button class="primary" id="btnRoll" onclick="rollDice()">üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏</button>
        <button class="danger" id="btnPayJail" onclick="payJail()" style="display:none">üí∞ –ó–∞–ø–ª–∞—Ç–∏—Ç—å $50</button>
        <button id="btnStayJail" onclick="stayJail()" style="display:none">‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥</button>
        <button id="btnBuy" onclick="buyProperty()" style="display:none">‚úÖ –ö—É–ø–∏—Ç—å</button>
        <button id="btnSkip" onclick="skipBuy()" style="display:none">‚ùå –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
        <button onclick="openManage()">üíº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
        <button class="warning" onclick="newGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      </div>
      
      <h2>üë• –ò–≥—Ä–æ–∫–∏</h2>
      <div class="players-list" id="playersList"></div>
      
      <h2>üìã –ñ—É—Ä–Ω–∞–ª</h2>
      <div class="log" id="log"></div>
    </aside>
  </div>
  
  <div class="modal" id="setupModal">
    <div class="modal-content">
      <h2>üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞</h2>
      
      <div class="form-group">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (2-4)</label>
        <input type="number" id="playerCount" min="2" max="4" value="2" onchange="updatePlayerInputs()">
      </div>
      
      <div class="form-group">
        <label>–ù–∞—á–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ ($)</label>
        <input type="number" id="startMoney" min="500" step="100" value="1500">
      </div>
      
      <div id="playerNames"></div>
      
      <div class="button-group">
        <button class="primary" onclick="startGame()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å</button>
        <button onclick="closeSetup()">‚ùå –û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
  
  <div class="modal" id="manageModal">
    <div class="modal-content">
      <h2>üíº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
      <div id="propertyList" style="max-height:400px;overflow-y:auto"></div>
      <div class="button-group">
        <button onclick="closeManage()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>

  <script>
    var BOARD = [
      {id:0,name:'START',type:'go'},
      {id:1,name:'NARVAVAGEN',type:'prop',color:'brown',price:60,rent:2},
      {id:2,name:'BYGGMADER',type:'chance'},
      {id:3,name:'KARLAVAEGEN',type:'prop',color:'brown',price:60,rent:4},
      {id:4,name:'SKATT',type:'tax',amount:200},
      {id:5,name:'OESTERBY',type:'station',price:200,rent:25},
      {id:6,name:'ALLMAN.',type:'prop',color:'lightblue',price:100,rent:6},
      {id:7,name:'CHANS',type:'chance'},
      {id:8,name:'STURE.',type:'prop',color:'lightblue',price:100,rent:6},
      {id:9,name:'GOETA.',type:'prop',color:'lightblue',price:120,rent:8},
      {id:10,name:'F√ÑNGELSE',type:'jail'},
      {id:11,name:'LAXGATAN',type:'prop',color:'pink',price:140,rent:10},
      {id:12,name:'EL.VERK',type:'utility',price:150,rent:0},
      {id:13,name:'RINGAV.',type:'prop',color:'pink',price:140,rent:10},
      {id:14,name:'G.STAN',type:'prop',color:'pink',price:160,rent:12},
      {id:15,name:'NARKS.',type:'station',price:200,rent:25},
      {id:16,name:'SVEA.',type:'prop',color:'orange',price:180,rent:14},
      {id:17,name:'BYGGM.',type:'chance'},
      {id:18,name:'KUNGS.',type:'prop',color:'orange',price:180,rent:14},
      {id:19,name:'MOENS.',type:'prop',color:'orange',price:200,rent:16},
      {id:20,name:'PARK',type:'parking'},
      {id:21,name:'STRAND.',type:'prop',color:'red',price:220,rent:18},
      {id:22,name:'CHANS',type:'chance'},
      {id:23,name:'NORRM.',type:'prop',color:'red',price:220,rent:18},
      {id:24,name:'HAMN.',type:'prop',color:'red',price:240,rent:20},
      {id:25,name:'NOERK.',type:'station',price:200,rent:25},
      {id:26,name:'VASA.',type:'prop',color:'yellow',price:260,rent:22},
      {id:27,name:'STRAN.',type:'prop',color:'yellow',price:260,rent:22},
      {id:28,name:'VATTEN',type:'utility',price:150,rent:0},
      {id:29,name:'BIBLIO.',type:'prop',color:'yellow',price:280,rent:24},
      {id:30,name:'‚ÜíF√ÑNGELSE',type:'gotojail'},
      {id:31,name:'OESTER.',type:'prop',color:'green',price:300,rent:26},
      {id:32,name:'NARVA.',type:'prop',color:'green',price:300,rent:26},
      {id:33,name:'BYGGM.',type:'chance'},
      {id:34,name:'STOER.',type:'prop',color:'green',price:320,rent:28},
      {id:35,name:'VAEST.',type:'station',price:200,rent:25},
      {id:36,name:'CHANS',type:'chance'},
      {id:37,name:'DJURG.',type:'prop',color:'darkblue',price:350,rent:35},
      {id:38,name:'SKATT',type:'tax',amount:100},
      {id:39,name:'STURE.',type:'prop',color:'darkblue',price:400,rent:50}
    ];
    
    var COLORS = ['#ef4444', '#3b82f6', '#22c55e', '#f59e0b'];
    
    var game = {
      players: [],
      current: 0,
      owned: {},
      dice: [1, 1]
    };
    
    function init() {
      createBoard();
      updatePlayerInputs();
      document.getElementById('setupModal').className = 'modal show';
    }
    
    function createBoard() {
      var board = document.getElementById('board');
      
      for (var i = 0; i < BOARD.length; i++) {
        var cell = BOARD[i];
        var cellDiv = document.createElement('div');
        cellDiv.className = 'cell';
        cellDiv.id = 'cell-' + i;
        
        var pos = getCellPosition(i);
        cellDiv.style.gridColumn = pos.col;
        cellDiv.style.gridRow = pos.row;
        
        var html = '<div>' + cell.name + '</div>';
        if (cell.price) {
          html += '<div class="price">$' + cell.price + '</div>';
        }
        cellDiv.innerHTML = html;
        
        board.appendChild(cellDiv);
      }
    }
    
    function getCellPosition(index) {
      if (index <= 10) return { row: 11, col: 11 - index };
      if (index <= 19) return { row: 11 - (index - 10), col: 1 };
      if (index <= 30) return { row: 1, col: index - 19 };
      return { row: index - 29, col: 11 };
    }
    
    function updatePlayerInputs() {
      var count = parseInt(document.getElementById('playerCount').value);
      var container = document.getElementById('playerNames');
      container.innerHTML = '';
      
      for (var i = 0; i < count; i++) {
        var group = document.createElement('div');
        group.className = 'form-group';
        group.innerHTML = '<label>–ò–≥—Ä–æ–∫ ' + (i + 1) + '</label><input type="text" id="playerName' + i + '" value="–ò–≥—Ä–æ–∫ ' + (i + 1) + '">';
        container.appendChild(group);
      }
    }
    
    function startGame() {
      var count = parseInt(document.getElementById('playerCount').value);
      var money = parseInt(document.getElementById('startMoney').value);
      
      game.players = [];
      for (var i = 0; i < count; i++) {
        var name = document.getElementById('playerName' + i).value || ('–ò–≥—Ä–æ–∫ ' + (i + 1));
        game.players.push({
          id: i,
          name: name,
          money: money,
          position: 0,
          jailTurns: 0
        });
      }
      
      game.current = 0;
      game.owned = {};
      
      closeSetup();
      updateUI();
      addLog('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞!', true);
      showToast('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞!');
    }
    
    function closeSetup() {
      document.getElementById('setupModal').className = 'modal';
    }
    
    function newGame() {
      document.getElementById('setupModal').className = 'modal show';
    }
    
    function rollDice() {
      var player = game.players[game.current];
      
      if (player.jailTurns > 0) {
        showToast('‚ùå –í—ã –≤ —Ç—é—Ä—å–º–µ!');
        document.getElementById('btnPayJail').style.display = 'block';
        document.getElementById('btnStayJail').style.display = 'block';
        document.getElementById('btnRoll').disabled = true;
        return;
      }
      
      var d1 = Math.floor(Math.random() * 6) + 1;
      var d2 = Math.floor(Math.random() * 6) + 1;
      game.dice = [d1, d2];
      
      document.getElementById('die1').textContent = d1;
      document.getElementById('die2').textContent = d2;
      
      var sum = d1 + d2;
      var isDouble = d1 === d2;
      
      addLog('üé≤ ' + player.name + ' –≤—ã–±—Ä–æ—Å–∏–ª ' + d1 + ' + ' + d2 + ' = ' + sum + (isDouble ? ' (–î–£–ë–õ–¨!)' : ''));
      
      document.getElementById('btnRoll').disabled = true;
      
      var oldPos = player.position;
      var newPos = (oldPos + sum) % 40;
      
      animateMove(player.id, oldPos, newPos, function() {
        player.position = newPos;
        
        if (newPos < oldPos) {
          player.money += 200;
          addLog('üí∞ ' + player.name + ' –ø—Ä–æ—à—ë–ª START +$200!', true);
          showToast('üí∞ +$200 –∑–∞ START!');
        }
        
        landOn(newPos, isDouble);
      });
      
      updateUI();
    }
    
    function animateMove(pid, from, to, done) {
      var steps = ((to - from) + 40) % 40;
      var i = 0;
      
      function step() {
        var player = game.players[pid];
        var currentPos = (from + i) % 40;
        player.position = currentPos;
        
        renderPips();
        setActiveCell(currentPos);
        
        i++;
        if (i <= steps) {
          setTimeout(step, 120);
        } else {
          player.position = to;
          renderPips();
          if (done) done();
        }
      }
      
      step();
    }
    
    function landOn(idx, isDouble) {
      var player = game.players[game.current];
      var cell = BOARD[idx];
      
      setActiveCell(idx);
      
      if (cell.type === 'gotojail') {
        player.position = 10;
        player.jailTurns = 1;
        addLog('üöî ' + player.name + ' –≤ –¢–Æ–†–¨–ú–£!', true);
        showAnno('üöî –í –¢–Æ–†–¨–ú–£!', 'rent');
        renderPips();
        setActiveCell(10);
        setTimeout(function() { nextTurn(); }, 2000);
        return;
      }
      
      if (cell.type === 'tax') {
        player.money -= cell.amount;
        addLog('üí∏ ' + player.name + ' –Ω–∞–ª–æ–≥ $' + cell.amount);
        showAnno('üí∏ –ù–∞–ª–æ–≥: $' + cell.amount, 'rent');
        updateUI();
      }
      
      if (cell.type === 'prop' || cell.type === 'station' || cell.type === 'utility') {
        handleProperty(idx, isDouble);
      } else {
        if (isDouble) {
          showToast('üé≤ –î—É–±–ª—å! –ë—Ä–æ—Å–∞–π—Ç–µ —Å–Ω–æ–≤–∞!');
          document.getElementById('btnRoll').disabled = false;
        } else {
          setTimeout(function() { nextTurn(); }, 800);
        }
      }
    }
    
    function handleProperty(idx, isDouble) {
      var player = game.players[game.current];
      var cell = BOARD[idx];
      var owned = game.owned[idx];
      
      if (!owned) {
        showAnno('üè† ' + cell.name + '\n–¶–µ–Ω–∞: $' + cell.price + '\n\n–í–´–ë–ï–†–ò–¢–ï:', 'buy');
        document.getElementById('btnBuy').style.display = 'block';
        document.getElementById('btnBuy').dataset.index = idx;
        document.getElementById('btnBuy').dataset.double = isDouble ? '1' : '0';
        document.getElementById('btnSkip').style.display = 'block';
        document.getElementById('btnSkip').dataset.double = isDouble ? '1' : '0';
        document.getElementById('btnRoll').disabled = true;
        addLog('üè† ' + player.name + ' –º–æ–∂–µ—Ç –∫—É–ø–∏—Ç—å ' + cell.name, true);
      } else if (owned.owner !== player.id) {
        var owner = game.players[owned.owner];
        if (owned.mortgaged) {
          showAnno(cell.name + '\n–í –∑–∞–ª–æ–≥–µ');
          if (isDouble) {
            document.getElementById('btnRoll').disabled = false;
          } else {
            setTimeout(function() { nextTurn(); }, 800);
          }
          return;
        }
        
        var rent = calculateRent(idx);
        player.money -= rent;
        owner.money += rent;
        addLog('üí∏ ' + player.name + ' ‚Üí ' + owner.name + ': $' + rent, true);
        showAnno('üí∏ –ê—Ä–µ–Ω–¥–∞: $' + rent, 'rent');
        updateUI();
        
        if (isDouble) {
          showToast('üé≤ –î—É–±–ª—å!');
          document.getElementById('btnRoll').disabled = false;
        } else {
          setTimeout(function() { nextTurn(); }, 800);
        }
      } else {
        showAnno('‚úÖ –í–∞—à–∞: ' + cell.name);
        if (isDouble) {
          document.getElementById('btnRoll').disabled = false;
        } else {
          setTimeout(function() { nextTurn(); }, 800);
        }
      }
    }
    
    function calculateRent(idx) {
      var cell = BOARD[idx];
      var owned = game.owned[idx];
      
      if (cell.type === 'station') {
        var count = 0;
        for (var key in game.owned) {
          var o = game.owned[key];
          if (o.owner === owned.owner && BOARD[o.id].type === 'station') count++;
        }
        return 25 * Math.pow(2, count - 1);
      }
      
      if (cell.type === 'utility') {
        var count = 0;
        for (var key in game.owned) {
          var o = game.owned[key];
          if (o.owner === owned.owner && BOARD[o.id].type === 'utility') count++;
        }
        return (game.dice[0] + game.dice[1]) * (count === 2 ? 10 : 4);
      }
      
      if (owned.hotel) return cell.rent * 32;
      if (owned.houses > 0) return cell.rent * Math.pow(2, owned.houses);
      
      var hasMonopoly = true;
      for (var i = 0; i < BOARD.length; i++) {
        var c = BOARD[i];
        if (c.type === 'prop' && c.color === cell.color) {
          if (!game.owned[c.id] || game.owned[c.id].owner !== owned.owner || game.owned[c.id].mortgaged) {
            hasMonopoly = false;
            break;
          }
        }
      }
      
      return hasMonopoly ? cell.rent * 2 : cell.rent;
    }
    
    function buyProperty() {
      var btn = document.getElementById('btnBuy');
      var idx = parseInt(btn.dataset.index);
      var isDouble = btn.dataset.double === '1';
      var player = game.players[game.current];
      var cell = BOARD[idx];
      
      if (player.money < cell.price) {
        showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
        return;
      }
      
      player.money -= cell.price;
      game.owned[idx] = {id: idx, owner: player.id, houses: 0, hotel: false, mortgaged: false};
      addLog('‚úÖ ' + player.name + ' –∫—É–ø–∏–ª ' + cell.name, true);
      showToast('‚úÖ –ö—É–ø–ª–µ–Ω–æ!');
      
      document.getElementById('btnBuy').style.display = 'none';
      document.getElementById('btnSkip').style.display = 'none';
      hideAnno();
      
      updateUI();
      
      if (isDouble) {
        showToast('üé≤ –î—É–±–ª—å!');
        document.getElementById('btnRoll').disabled = false;
      } else {
        setTimeout(function() { nextTurn(); }, 500);
      }
    }
    
    function skipBuy() {
      var btn = document.getElementById('btnSkip');
      var isDouble = btn.dataset.double === '1';
      
      addLog('‚è≠Ô∏è ' + game.players[game.current].name + ' –ø—Ä–æ–ø—É—Å—Ç–∏–ª');
      
      document.getElementById('btnBuy').style.display = 'none';
      document.getElementById('btnSkip').style.display = 'none';
      hideAnno();
      
      if (isDouble) {
        showToast('üé≤ –î—É–±–ª—å!');
        document.getElementById('btnRoll').disabled = false;
      } else {
        setTimeout(function() { nextTurn(); }, 500);
      }
    }
    
    function payJail() {
      var player = game.players[game.current];
      
      if (player.money < 50) {
        showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
        return;
      }
      
      player.money -= 50;
      player.jailTurns = 0;
      addLog('üîì ' + player.name + ' –∑–∞–ø–ª–∞—Ç–∏–ª $50', true);
      showToast('üîì –í—ã—Ö–æ–¥!');
      
      document.getElementById('btnPayJail').style.display = 'none';
      document.getElementById('btnStayJail').style.display = 'none';
      document.getElementById('btnRoll').disabled = false;
      
      updateUI();
    }
    
    function stayJail() {
      var player = game.players[game.current];
      
      player.jailTurns++;
      addLog('‚è≠Ô∏è ' + player.name + ' –ø—Ä–æ–ø—É—Å–∫ (' + player.jailTurns + '/3)');
      
      if (player.jailTurns >= 3) {
        player.jailTurns = 0;
        addLog('üîì ' + player.name + ' –≤—ã—à–µ–ª –ë–ï–°–ü–õ–ê–¢–ù–û!', true);
        showToast('üîì –°–≤–æ–±–æ–¥–Ω—ã!');
      }
      
      document.getElementById('btnPayJail').style.display = 'none';
      document.getElementById('btnStayJail').style.display = 'none';
      
      updateUI();
      nextTurn();
    }
    
    function nextTurn() {
      document.getElementById('btnBuy').style.display = 'none';
      document.getElementById('btnSkip').style.display = 'none';
      document.getElementById('btnPayJail').style.display = 'none';
      document.getElementById('btnStayJail').style.display = 'none';
      document.getElementById('btnRoll').disabled = false;
      hideAnno();
      
      game.current = (game.current + 1) % game.players.length;
      
      var player = game.players[game.current];
      updateUI();
      setActiveCell(player.position);
      
      if (player.jailTurns > 0) {
        document.getElementById('btnPayJail').style.display = 'block';
        document.getElementById('btnStayJail').style.display = 'block';
        document.getElementById('btnRoll').disabled = true;
        addLog('üîí ' + player.name + ' –≤ —Ç—é—Ä—å–º–µ', true);
        showToast('üîí –í —Ç—é—Ä—å–º–µ!');
      }
    }
    
    function openManage() {
      var player = game.players[game.current];
      var list = document.getElementById('propertyList');
      list.innerHTML = '';
      
      var hasProperty = false;
      for (var key in game.owned) {
        var prop = game.owned[key];
        if (prop.owner === player.id) {
          hasProperty = true;
          var cell = BOARD[prop.id];
          
          var status = '';
          if (prop.hotel) status = 'üè® –û—Ç–µ–ª—å';
          else if (prop.houses > 0) status = 'üè† ' + prop.houses + ' –¥–æ–º(–∞)';
          else if (prop.mortgaged) status = 'üîí –ó–∞–ª–æ–≥';
          
          var div = document.createElement('div');
          div.style.padding = '10px';
          div.style.marginBottom = '10px';
          div.style.background = '#0f172a';
          div.style.border = '2px solid #334155';
          div.style.borderRadius = '8px';
          div.innerHTML = '<strong>' + cell.name + '</strong><br><small>' + (status || '–ü—É—Å—Ç–æ') + '</small>';
          list.appendChild(div);
        }
      }
      
      if (!hasProperty) {
        list.innerHTML = '<p style="text-align:center;padding:20px">–ù–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</p>';
      }
      
      document.getElementById('manageModal').className = 'modal show';
    }
    
    function closeManage() {
      document.getElementById('manageModal').className = 'modal';
    }
    
    function updateUI() {
      renderPlayers();
      renderPips();
      updateOwnership();
      updateTurnHUD();
    }
    
    function renderPlayers() {
      var list = document.getElementById('playersList');
      list.innerHTML = '';
      
      for (var i = 0; i < game.players.length; i++) {
        var player = game.players[i];
        var card = document.createElement('div');
        card.className = 'player-card';
        if (i === game.current) card.className += ' active';
        if (player.jailTurns > 0) card.className += ' in-jail';
        
        var html = '<div class="player-info">';
        html += '<div class="swatch" style="background:' + COLORS[player.id] + '"></div>';
        html += '<strong>' + player.name + '</strong>';
        if (player.jailTurns > 0) {
          html += '<span class="jail-badge">üîí ' + player.jailTurns + '/3</span>';
        }
        html += '</div>';
        html += '<div class="player-money">$' + player.money + '</div>';
        
        card.innerHTML = html;
        list.appendChild(card);
      }
    }
    
    function renderPips() {
      var cells = document.querySelectorAll('.pips');
      for (var i = 0; i < cells.length; i++) {
        cells[i].remove();
      }
      
      for (var i = 0; i < game.players.length; i++) {
        var player = game.players[i];
        var cell = document.getElementById('cell-' + player.position);
        if (!cell) continue;
        
        var pips = cell.querySelector('.pips');
        if (!pips) {
          pips = document.createElement('div');
          pips.className = 'pips';
          cell.appendChild(pips);
        }
        
        var pip = document.createElement('div');
        pip.className = 'pip';
        pip.style.background = COLORS[player.id];
        pips.appendChild(pip);
      }
    }
    
    function updateOwnership() {
      var tags = document.querySelectorAll('.owner-tag');
      for (var i = 0; i < tags.length; i++) {
        tags[i].remove();
      }
      
      for (var key in game.owned) {
        var owned = game.owned[key];
        var cell = document.getElementById('cell-' + key);
        if (!cell) continue;
        
        var tag = document.createElement('div');
        tag.className = 'owner-tag';
        tag.style.background = COLORS[owned.owner];
        if (owned.mortgaged) tag.style.opacity = '0.4';
        cell.appendChild(tag);
      }
    }
    
    function updateTurnHUD() {
      var player = game.players[game.current];
      document.getElementById('turnDot').style.background = COLORS[player.id];
      document.getElementById('turnName').textContent = player.name;
    }
    
    function setActiveCell(idx) {
      var cells = document.querySelectorAll('.cell');
      for (var i = 0; i < cells.length; i++) {
        cells[i].className = 'cell';
      }
      
      var cell = document.getElementById('cell-' + idx);
      if (cell) {
        cell.className = 'cell active';
      }
    }
    
    function addLog(msg, important) {
      var log = document.getElementById('log');
      var entry = document.createElement('div');
      entry.className = 'log-entry' + (important ? ' important' : '');
      entry.textContent = msg;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }
    
    function showToast(msg) {
      var toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = 'toast show';
      setTimeout(function() {
        toast.className = 'toast';
      }, 2500);
    }
    
    function showAnno(msg, type) {
      var anno = document.getElementById('anno');
      anno.textContent = msg;
      anno.className = 'anno show' + (type ? ' ' + type : '');
    }
    
    function hideAnno() {
      var anno = document.getElementById('anno');
      anno.className = 'anno';
    }
    
    window.onload = init;
  </script>
</body>
</html>
